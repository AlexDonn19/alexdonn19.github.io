function makeRandomData(e){var t,n,i;for(t=e.images.length-1;0!==t;)i=Math.floor(Math.random()*t),t-=1,n=e.images[t],e.images[t]=e.images[i],e.images[i]=n;return e}function takeNewData(newTheme){if("XDomainRequest"in window&&null!==window.XDomainRequest){var xdr=new XDomainRequest;xdr.open("get","http://api.pixplorer.co.uk/image?word="+newTheme+"&amount=7&size=tb"),xdr.onload=function(){var JSON=JSON||{};JSON.parse=JSON.parse||function(str){return""===str&&(str='""'),eval("var p="+str+";"),p};var dom=new ActiveXObject("Microsoft.XMLDOM"),JSON=JSON.parse(xdr.responseText);dom.async=!1,null!=JSON&&"undefined"!=typeof JSON||(JSON=JSON.parse(data.firstChild.textContent)),"failed"!=JSON.status&&(renderList(JSON),doMasonry(),ie8shadowAdd(".grid"))},xdr.onerror=function(){_result=!1},xdr.send()}else{if(navigator.userAgent.indexOf("MSIE")!=-1&&parseInt(navigator.userAgent.match(/MSIE ([\d.]+)/)[1],10)<8)return!1;var xhr=new XMLHttpRequest,URL="http://api.pixplorer.co.uk/image?word="+encodeURIComponent(newTheme)+"&amount=7&size=tb&callback=?";xhr.open("GET",URL,!0),xhr.setRequestHeader("Content-type","application/json; charset=utf-8"),xhr.send(),xhr.onreadystatechange=function(){if(4==this.readyState){if(200!=this.status)return void alert("ошибка: "+(this.status?this.statusText:"запрос не удался"));try{var e=JSON.parse(xhr.responseText);renderList(e),doMasonry()}catch(e){alert("Некорректный ответ "+e.message)}}}}}function ie8shadowAdd(e){var t="body"==e?document.getElementsByTagName(e)[0]:document.querySelectorAll(e)[0],n=t.querySelectorAll(".ie8shadow"),i=document.createElement("div");i.innerText="",i.style.display="block",i.style.width="100%",i.style.height="100%",i.style.background="#000",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.filter="alpha(Opacity=25)",i.style.zIndex="1";for(var r=0;r<n.length;r++)n[r].appendChild(i),n[r].innerHTML+="<div></div>"}function nextElementSibling(e){if(e.nextElementSibling)return e.nextElementSibling;do e=e.nextSibling;while(e&&1!==e.nodeType);return e}function previousElementSibling(e){if(e.previousElementSibling)return e.previousElementSibling;do e=e.previousSibling;while(e&&1!==e.nodeType);return e}function getArrNoClass(e,t){for(var n=e.length,i=[],r=0;r<n;r++)myHasClass(e[r],t)||i.push(e[r]);return i}function myHasClass(e,t){return null!=e&&new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)}function addListener(e,t,n,i){e in _eventHandlers||(_eventHandlers[e]={}),t in _eventHandlers[e]||(_eventHandlers[e][t]=[]),_eventHandlers[e][t].push([n,i]),document.addEventListener?e.addEventListener(t,n,i):e.attachEvent("on"+t,n,i)}function removeAllListeners(e,t){if(e in _eventHandlers){var n=_eventHandlers[e];if(t in n)for(var i=n[t],r=i.length;r--;){var a=i[r];document.removeEventListener?e.removeEventListener(t,a[0],a[1]):e.detachEvent("on"+t,a[0],a[1])}}}function doMasonry(){var e={itemSelector:".grid-item",gutter:18,fitWidth:!0,columnWidth:".grid-sizer"},t=document.getElementById("activity_container"),n=t.querySelectorAll(".grid-item"),i=new Masonry(".grid",e);i.layout(),addListener(t,"click",function(e){var r=e||window.event,a=r.target||r.srcElement,s=a.parentNode,l=myHasClass(s,"grid-sizer"),o=myHasClass(s,"grid-item");if(!l&&o){var d=myHasClass(s,"grid-item--width2");if(d){var m=getArrNoClass(n,"grid-item--width2"),u=getRandomInt(1,3);m[u].classList.toggle("grid-item--width2")}else{var c=t.querySelectorAll(".grid-item--width2"),g=previousElementSibling(s),v=myHasClass(s,"grid-last"),f=myHasClass(g,"grid-item--width2");if(v&&f)c[1].classList.toggle("grid-item--width2");else{var p=nextElementSibling(s),h=t.querySelectorAll(".grid-last")[0],y=myHasClass(h,"grid-item--width2"),w=myHasClass(p,"grid-last");w&&y?h.classList.toggle("grid-item--width2"):c[0].classList.toggle("grid-item--width2")}}s.classList.toggle("grid-item--width2"),i.layout()}},!1)}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function renderList(e){var t=e,n=document.getElementById("activity_container");n.innerHTML="",removeAllListeners(n,"click");var i=document.getElementById("make-activities").innerHTML,r=tmpl(i,t);n.innerHTML+=r;var a=document.querySelectorAll(".grid-item");a[0].classList.add("grid-sizer"),a[6].classList.add("grid-last");var s=2;do{var l=getRandomInt(1,5);myHasClass(a[l],"grid-item--width2")||(a[l].classList.add("grid-item--width2"),s--)}while(0!=s);return!0}function ie8getElementsByClass(e,t){var n,i,t=t||document,r=t.getElementsByTagName("*"),a=r.length,s=e.split(/\s+/),l=s.length,o=[];for(n=0;n<a;n++)for(i=0;i<l;i++)if(r[n].className.search("\\b"+s[i]+"\\b")!=-1){o.push(r[n]);break}return o}function moveSlider(e,t,n,i){if(t===n)return void(e.style.left=n+"px");var r=Math.abs(t-n),a=r/i^0,s=10,l=s;a+=s;var o=l/i^0,d=t,m=t>n?1:-1,u=setInterval(function(){0==s&&(m*=i),a--,s--,d-=m,e.style.left=d+"px",a==o&&(clearInterval(u),e.style.left=n+"px")},1)}function carousel(e,t){var n=e.getElementsByTagName("ul")[0],i=e.getElementsByTagName("li"),r=i[0].offsetWidth,a=i.length,s=r*a;if("getElementsByClassName"in window)var l=e.getElementsByClassName("control_left")[0],o=e.getElementsByClassName("control_right")[0];else var l=e.querySelectorAll(".control_left")[0],o=e.querySelectorAll(".control_right")[0];var d=t<a?t:0,m=-d*r;n.style.left=m+"px";var u=d,c=-(s-r),g=0;document.addEventListener?(l.addEventListener("click",function(){m!=g?(moveSlider(n,m,m+r,2),m+=r,u--):(moveSlider(n,m,c,20),m=c,u=a-1)}),o.addEventListener("click",function(){m!=c?(moveSlider(n,m,m-r,2),m-=r,u++):(moveSlider(n,m,g,20),m=g,n.style.left=m+"px",u=0)}),window.addEventListener("resize",function(){r=i[0].offsetWidth,s=r*a,m=-u*r,n.style.left=m+"px",c=-(s-r)})):(l.attachEvent("onclick",function(){r=i[0].offsetWidth,0!=u?moveSlider(n,-u*r,- --u*r,10):(moveSlider(n,-u*r,-(a-1)*r,50),u=a-1)}),o.attachEvent("onclick",function(){r=i[0].offsetWidth,u!=a-1?moveSlider(n,-u*r,-++u*r,10):(moveSlider(n,-u*r,g,50),u=0)}),e.attachEvent("onresize",function(){r=i[0].offsetWidth,m=-(u*r),n.style.left=m+"px"}))}var _eventHandlers={};window.onload=function(){var e,t='{"images":[{"imageurl":"./img/act1.jpg","word":"Sport and Activity"},{"imageurl":"./img/act2.jpg","word":"Wellnes and Health"},{"imageurl":"./img/act3.jpg","word":"Extreme Sports and Expeditions"},{"imageurl":"./img/act4.jpg","word":"Games"},{"imageurl":"./img/act5.jpg","word":"Culture and Education"},{"imageurl":"./img/act6.jpg","word":"Relaxation"},{"imageurl":"./img/act7.jpg","word":"Travelling"}],"status":"success","count":7}',n=JSON.parse(t);makeRandomData(n),renderList(n);for(var i=document.querySelectorAll(".grid-item"),r=0;r<i.length;r++){var a=i[r].getElementsByTagName("img")[0];a.classList.add("img_first")}doMasonry();var s=document.getElementById("discover");"XDomainRequest"in window&&null!==window.XDomainRequest?(ie8shadowAdd("body"),s.attachEvent("onsubmit",function(t){return t.returnValue=!1,e=document.getElementById("interests").value,document.getElementById("interests").value="",takeNewData(e),!1})):s.onsubmit=function(t){t.preventDefault(),e=document.getElementById("interests").value,document.getElementById("interests").value="",takeNewData(e)};var l,o;l=document.getElementById("sliderBlock"),o=document.getElementsByClassName?l.getElementsByClassName("slider"):ie8getElementsByClass("slider",l);new carousel(o[0],0),new carousel(o[1],1),new carousel(o[2],2)},function(){var e={};this.tmpl=function t(n,i){var r=/\W/.test(n)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[n]=e[n]||t(document.getElementById(n).innerHTML);return i?r(i):r}}();