function makeRandomData(e){var t,n,i;for(t=e.hits.length-1;0!==t;)i=Math.floor(Math.random()*t),t-=1,n=e.hits[t],e.hits[t]=e.hits[i],e.hits[i]=n;return e}function getMyKey(){var e={first:3669397,second:42513,third:"f591a1fa4ca1438635fa"};return e.first++,e.second++,e.first+"-"+e.second+e.third}function takeNewData(newTheme){var myKey=getMyKey(),callback="",URL="https://pixabay.com/api/?key="+myKey+"&image_type=all&pretty=true&per_page=7&orientation=horizontal"+callback+"&q="+encodeURIComponent(newTheme);if("XDomainRequest"in window&&null!==window.XDomainRequest){var xdr=new XDomainRequest;xdr.open("get",URL),xdr.onload=function(){var JSON=JSON||{};JSON.parse=JSON.parse||function(str){return""===str&&(str='""'),eval("var p="+str+";"),p};var dom=new ActiveXObject("Microsoft.XMLDOM"),JSON=JSON.parse(xdr.responseText);dom.async=!1,null!=JSON&&"undefined"!=typeof JSON||(JSON=JSON.parse(data.firstChild.textContent)),"failed"!=JSON.status&&(jsonData=JSON,renderList(JSON),doMasonry(),ie8shadowAdd(".grid"))},xdr.onerror=function(){_result=!1},xdr.send()}else{if(navigator.userAgent.indexOf("MSIE")!=-1&&parseInt(navigator.userAgent.match(/MSIE ([\d.]+)/)[1],10)<8)return!1;var xhr=new XMLHttpRequest;xhr.open("GET",URL,!0),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8"),xhr.send(),xhr.onreadystatechange=function(){if(4==this.readyState){if(200!=this.status)return void alert("ошибка: "+(this.status?this.statusText:"запрос не удался"));try{var e=JSON.parse(xhr.responseText);jsonData=e,renderList(e),doMasonry()}catch(e){alert("Некорректный ответ "+e.message)}}}}}function ie8shadowAdd(e){var t="body"==e?document.getElementsByTagName(e)[0]:document.querySelectorAll(e)[0],n=t.querySelectorAll(".ie8shadow"),i=document.createElement("div");i.innerText="",i.style.display="block",i.style.width="100%",i.style.height="100%",i.style.background="#000",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.filter="alpha(Opacity=25)",i.style.zIndex="1";for(var a=0;a<n.length;a++)n[a].appendChild(i),n[a].innerHTML+="<div></div>"}function nextElementSibling(e){if(e.nextElementSibling)return e.nextElementSibling;do e=e.nextSibling;while(e&&1!==e.nodeType);return e}function previousElementSibling(e){if(e.previousElementSibling)return e.previousElementSibling;do e=e.previousSibling;while(e&&1!==e.nodeType);return e}function getArrNoClass(e,t){for(var n=e.length,i=[],a=0;a<n;a++)myHasClass(e[a],t)||i.push(e[a]);return i}function myHasClass(e,t){return null!=e&&new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)}function addListener(e,t,n,i){e in _eventHandlers||(_eventHandlers[e]={}),t in _eventHandlers[e]||(_eventHandlers[e][t]=[]),_eventHandlers[e][t].push([n,i]),document.addEventListener?e.addEventListener(t,n,i):e.attachEvent("on"+t,n,i)}function removeAllListeners(e,t){if(e in _eventHandlers){var n=_eventHandlers[e];if(t in n)for(var i=n[t],a=i.length;a--;){var r=i[a];document.removeEventListener?e.removeEventListener(t,r[0],r[1]):e.detachEvent("on"+t,r[0],r[1])}}}function getBrowserSize(){var e=0;return"number"==typeof window.innerWidth?e=window.innerWidth:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?e=document.documentElement.clientWidth:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth),e}function getMasonryColumnSize(e){var t;return t=e<768?300:e>=768&&e<1440?236:300}function getDevType(e){var t;return t=e<768?"mob":e>=768&&e<1440?"tabl":"desk"}function doMasonry(){var e=getBrowserSize(),t=getMasonryColumnSize(e);null!=masonryObj&&(masonryObj.destroy(),masonryObj=null);var n={itemSelector:".grid-item",gutter:18,fitWidth:!0,columnWidth:t},i=document.getElementById("activity_container"),a=i.querySelectorAll(".grid-item"),r=new Masonry(".grid",n);r.layout(),masonryObj=r,addListener(i,"click",function(e){var t,n,s,o=e||window.event,l=o.target||o.srcElement,d=l.parentNode,m=myHasClass(d,"grid-item");if(m){var c=myHasClass(d,"grid-item--width2");if(c){var u=getArrNoClass(a,"grid-item--width2");t=getRandomInt(0,4),u[t].classList.toggle("grid-item--width2")}else{var g=i.querySelectorAll(".grid-item--width2");t=getRandomInt(0,1),g[t].classList.toggle("grid-item--width2")}d.classList.toggle("grid-item--width2"),n=myHasClass(a[6],"grid-item--width2"),s=myHasClass(a[5],"grid-item--width2"),n&&s&&(a[1].classList.toggle("grid-item--width2"),a[6].classList.toggle("grid-item--width2")),r.layout()}},!1)}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function renderList(e){var t=e,n=document.getElementById("activity_container");n.innerHTML="",removeAllListeners(n,"click");var i=document.getElementById("make-activities").innerHTML,a=tmpl(i,t);n.innerHTML+=a;var r=document.querySelectorAll(".grid-item"),s=2;do{var o=getRandomInt(0,6);myHasClass(r[o],"grid-item--width2")||(r[o].classList.add("grid-item--width2"),s--)}while(0!=s);var l=myHasClass(r[6],"grid-item--width2"),d=myHasClass(r[5],"grid-item--width2");return l&&d&&(r[1].classList.toggle("grid-item--width2"),r[6].classList.toggle("grid-item--width2")),!0}function ie8getElementsByClass(e,t){var n,i,t=t||document,a=t.getElementsByTagName("*"),r=a.length,s=e.split(/\s+/),o=s.length,l=[];for(n=0;n<r;n++)for(i=0;i<o;i++)if(a[n].className.search("\\b"+s[i]+"\\b")!=-1){l.push(a[n]);break}return l}function moveSlider(e,t,n,i){if(t===n)return void(e.style.left=n+"px");var a=Math.abs(t-n),r=a/i^0,s=10,o=s;r+=s;var l=o/i^0,d=t,m=t>n?1:-1,c=setInterval(function(){0==s&&(m*=i),r--,s--,d-=m,e.style.left=d+"px",r==l&&(clearInterval(c),e.style.left=n+"px")},1)}function carousel(e,t){var n=e.getElementsByTagName("ul")[0],i=e.getElementsByTagName("li"),a=i[0].offsetWidth,r=i.length,s=a*r;if("getElementsByClassName"in window)var o=e.getElementsByClassName("control_left")[0],l=e.getElementsByClassName("control_right")[0];else var o=e.querySelectorAll(".control_left")[0],l=e.querySelectorAll(".control_right")[0];var d=t<r?t:0,m=-d*a;n.style.left=m+"px";var c=d,u=-(s-a),g=0;document.addEventListener?(o.addEventListener("click",function(){m!=g?(moveSlider(n,m,m+a,2),m+=a,c--):(moveSlider(n,m,u,20),m=u,c=r-1)}),l.addEventListener("click",function(){m!=u?(moveSlider(n,m,m-a,2),m-=a,c++):(moveSlider(n,m,g,20),m=g,n.style.left=m+"px",c=0)}),window.addEventListener("resize",function(){a=i[0].offsetWidth,s=a*r,m=-c*a,n.style.left=m+"px",u=-(s-a)})):(o.attachEvent("onclick",function(){a=i[0].offsetWidth,0!=c?moveSlider(n,-c*a,- --c*a,10):(moveSlider(n,-c*a,-(r-1)*a,50),c=r-1)}),l.attachEvent("onclick",function(){a=i[0].offsetWidth,c!=r-1?moveSlider(n,-c*a,-++c*a,10):(moveSlider(n,-c*a,g,50),c=0)}),e.attachEvent("onresize",function(){a=i[0].offsetWidth,m=-(c*a),n.style.left=m+"px"}))}var _eventHandlers={},masonryObj=null,jsonData;window.onload=function(){var e,t,n,i,a='{"hits":[{"webformatURL":"./img/act1-mob.jpg","tags":"Sport and Activity"},{"webformatURL":"./img/act2-mob.jpg","tags":"Wellnes and Health"},{"webformatURL":"./img/act3-mob.jpg","tags":"Extreme Sports and Expeditions"},{"webformatURL":"./img/act4-mob.jpg","tags":"Games"},{"webformatURL":"./img/act5-mob.jpg","tags":"Culture and Education"},{"webformatURL":"./img/act6-mob.jpg","tags":"Relaxation"},{"webformatURL":"./img/act7-mob.jpg","tags":"Travelling"}],"status":"success","count":7}',r='{"hits":[{"webformatURL":"./img/act1.jpg","tags":"Sport and Activity"},{"webformatURL":"./img/act2.jpg","tags":"Wellnes and Health"},{"webformatURL":"./img/act3.jpg","tags":"Extreme Sports and Expeditions"},{"webformatURL":"./img/act4.jpg","tags":"Games"},{"webformatURL":"./img/act5.jpg","tags":"Culture and Education"},{"webformatURL":"./img/act6.jpg","tags":"Relaxation"},{"webformatURL":"./img/act7.jpg","tags":"Travelling"}],"status":"success","count":7}',s=getBrowserSize(),o=getDevType(s);getMasonryColumnSize(s);s<768?e=a:s>=768&&(e=r),jsonData=JSON.parse(e),makeRandomData(jsonData),renderList(jsonData),doMasonry();var l=document.getElementById("discover");"XDomainRequest"in window&&null!==window.XDomainRequest?(ie8shadowAdd("body"),l.attachEvent("onsubmit",function(e){return e.returnValue=!1,i=document.getElementById("interests").value,document.getElementById("interests").value="",takeNewData(i),!1}),window.attachEvent("onresize",function(){t=getBrowserSize(),n=getDevType(t),n!=o&&(o=n,s=t,renderList(jsonData),doMasonry())})):(l.onsubmit=function(e){e.preventDefault(),i=document.getElementById("interests").value,document.getElementById("interests").value="",takeNewData(i)},window.addEventListener("resize",function(){t=getBrowserSize(),n=getDevType(t),n!=o&&(o=n,s=t,renderList(jsonData),doMasonry())}));var d,m;d=document.getElementById("sliderBlock"),m=document.getElementsByClassName?d.getElementsByClassName("slider"):ie8getElementsByClass("slider",d);new carousel(m[0],0),new carousel(m[1],1),new carousel(m[2],2)},function(){var e={};this.tmpl=function t(n,i){var a=/\W/.test(n)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[n]=e[n]||t(document.getElementById(n).innerHTML);return i?a(i):a}}();